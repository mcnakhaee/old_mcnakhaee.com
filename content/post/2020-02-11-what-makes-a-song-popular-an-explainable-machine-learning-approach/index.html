---
title: What Makes a Song Popular? an Explainable Machine Learning Approach
author: Muhammad Chenariyan Nakhaee
date: '2020-02-11'
slug: []
categories:
  - XAI
  - R
tags:
  - XAI
  - Python
subtitle: ''
summary: ''
authors: []
lastmod: '2020-02-11T22:27:18+01:00'
featured: no
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<pre class="r"><code>library(tidyverse)
library(lubridate)
library(corrr)
spotify_songs &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2020/2020-01-21/spotify_songs.csv&#39;)
head(spotify_songs)</code></pre>
<pre><code>## # A tibble: 6 x 23
##   track_id track_name track_artist track_popularity track_album_id
##   &lt;chr&gt;    &lt;chr&gt;      &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;         
## 1 6f807x0~ I Don&#39;t C~ Ed Sheeran                 66 2oCs0DGTsRO98~
## 2 0r7CVbZ~ Memories ~ Maroon 5                   67 63rPSO264uRjW~
## 3 1z1Hg7V~ All the T~ Zara Larsson               70 1HoSmj2eLcsrR~
## 4 75Fpbth~ Call You ~ The Chainsm~               60 1nqYsOef1yKKu~
## 5 1e8PAfc~ Someone Y~ Lewis Capal~               69 7m7vv9wlQ4i0L~
## 6 7fvUMiy~ Beautiful~ Ed Sheeran                 67 2yiy9cd2QktrN~
## # ... with 18 more variables: track_album_name &lt;chr&gt;,
## #   track_album_release_date &lt;chr&gt;, playlist_name &lt;chr&gt;, playlist_id &lt;chr&gt;,
## #   playlist_genre &lt;chr&gt;, playlist_subgenre &lt;chr&gt;, danceability &lt;dbl&gt;,
## #   energy &lt;dbl&gt;, key &lt;dbl&gt;, loudness &lt;dbl&gt;, mode &lt;dbl&gt;, speechiness &lt;dbl&gt;,
## #   acousticness &lt;dbl&gt;, instrumentalness &lt;dbl&gt;, liveness &lt;dbl&gt;, valence &lt;dbl&gt;,
## #   tempo &lt;dbl&gt;, duration_ms &lt;dbl&gt;</code></pre>
<p>Have you ever wondered why some songs from an artist become popular and others become a total failure? As you can see in the following plot even The Beetles had a few not so popular songs. I find it to be an interesting question that can be answered to some extent by machine learning algorithms and explainable machine learning methods.</p>
<pre class="r"><code>spotify_songs %&gt;% 
  filter(track_artist == &#39;The Beatles&#39;,track_popularity&gt;10) %&gt;% 
  ggplot(aes(x = track_popularity)) +
  geom_histogram() </code></pre>
<p><img src="/post/2020-02-11-what-makes-a-song-popular-an-explainable-machine-learning-approach/index_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>In the second part of this post, I will demonstrate how I designed a machine learning workflow for predicting the popularity of songs based on several audio features. Here my goal from developing a machine learning model is not just to predict the popularity of a song but rather to figure out which factors contribute to the popularity or the unpopularity of a song. Therefore, I will use several explainable machine learning methods such as LIME and SHAP to peek inside my trained machine learning models. Having done that, we can better understand what</p>
<div id="machine-learning" class="section level2">
<h2>Machine Learning</h2>
<div id="exploratory-data-analysis" class="section level3">
<h3>Exploratory data analysis</h3>
<pre class="r"><code>spotify_songs %&gt;% 
  select(track_popularity, c(12:23)) %&gt;% 
  correlate() %&gt;% 
    network_plot(min_cor = 0.1,color = c(&#39;#1a535c&#39;,&#39;#4ecdc4&#39;,&#39;#f7fff7&#39;,&#39;#ff6b6b&#39;,&#39;#ffe66d&#39;)) </code></pre>
<pre><code>## 
## Correlation method: &#39;pearson&#39;
## Missing treated using: &#39;pairwise.complete.obs&#39;</code></pre>
<p><img src="/post/2020-02-11-what-makes-a-song-popular-an-explainable-machine-learning-approach/index_files/figure-html/unnamed-chunk-3-1.png" width="768" /></p>
<pre class="r"><code>spotify_songs %&gt;% 
  ggplot(aes(track_popularity)) +
  geom_histogram(fill = &#39;indianred&#39;) </code></pre>
<pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
<p><img src="/post/2020-02-11-what-makes-a-song-popular-an-explainable-machine-learning-approach/index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p>Local explanations to understand what feature values contribute to the popularity of a particular song.
Global explanations such as feature importance scores to understand to the popularity of songs.</p>
<p>To use a explainable machine learning methods for this purpose, it is important to obtain a reasonable performance on the prediction task. Otherwise, the result would be unreliable.</p>
</div>
</div>
<div id="shap" class="section level2">
<h2>Shap</h2>
<div id="machine-learning-1" class="section level3">
<h3>Machine Learning</h3>
<pre class="r"><code>#rf &lt;- rand_forest(trees = 100, mode = &#39;regression&#39;) %&gt;% 
  #set_engine(&quot;randomForest&quot;) %&gt;% 
  #fit(Species ~. ,data = iris_training)</code></pre>
<pre class="python"><code>import lime
import shap</code></pre>
</div>
</div>
<div id="references-and-further-readings" class="section level2">
<h2>References and further readings</h2>
<p><a href="https://www.kaylinpavlik.com/classifying-songs-genres/" class="uri">https://www.kaylinpavlik.com/classifying-songs-genres/</a></p>
</div>
