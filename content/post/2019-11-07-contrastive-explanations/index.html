---
title: Contrastive Explanations
author: Muhammad Chenariyan Nakhaee
date: '2019-11-07'
slug: []
categories: []
tags:
  - Machine Learning
  - XAI
subtitle: ''
summary: ''
authors: []
lastmod: '2019-12-29T12:41:22+01:00'
featured: no
draft: TRUE
image:
  caption: ''
  focal_point: ''
  preview_only: no
projects: []
---



<pre class="r"><code>library(reticulate)
options(jupyter.display = &#39;rich&#39;)
library(tidyverse)
conda_list()</code></pre>
<pre><code>##           name
## 1  r-miniconda
## 2 r-reticulate
## 3   Anaconda37
## 4 r-tensorflow
##                                                                              python
## 1                     C:\\Users\\iMuhammad\\AppData\\Local\\r-miniconda\\python.exe
## 2 C:\\Users\\iMuhammad\\AppData\\Local\\r-miniconda\\envs\\r-reticulate\\python.exe
## 3                                           D:\\ProgramData\\Anaconda37\\python.exe
## 4                       D:\\ProgramData\\Anaconda37\\envs\\r-tensorflow\\python.exe</code></pre>
<pre class="r"><code>py_config()</code></pre>
<pre><code>## python:         D:/ProgramData/Anaconda37/python.exe
## libpython:      D:/ProgramData/Anaconda37/python37.dll
## pythonhome:     D:/ProgramData/Anaconda37
## version:        3.7.3 (default, Mar 27 2019, 17:13:21) [MSC v.1915 64 bit (AMD64)]
## Architecture:   64bit
## numpy:          D:/ProgramData/Anaconda37/Lib/site-packages/numpy
## numpy_version:  1.16.2
## 
## NOTE: Python version was forced by RETICULATE_PYTHON</code></pre>
<pre class="python"><code>import pandas as pd
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split</code></pre>
<pre><code>##   PassengerId Survived Pclass Age SibSp Parch    Fare Embarked_C Embarked_Q
## 0           1        0      3  22     1     0  7.2500          0          0
## 1           2        1      1  38     1     0 71.2833          1          0
## 2           3        1      3  26     0     0  7.9250          0          0
## 3           4        1      1  35     1     0 53.1000          0          0
## 4           5        0      3  35     0     0  8.0500          0          0
## 6           7        0      1  54     0     0 51.8625          0          0
##   Embarked_S Sex_binary
## 0          1          0
## 1          0          1
## 2          1          1
## 3          1          1
## 4          1          0
## 6          1          0</code></pre>
<pre class="python"><code>
X = titanic_dummified.drop([&#39;Survived&#39;],axis=1)
y = titanic_dummified[&#39;Survived&#39;]
train, test, labels_train, labels_test = train_test_split(X, y, train_size=0.80)</code></pre>
<pre class="python"><code>rf = RandomForestClassifier(n_estimators=100)
rf.fit(train,labels_train)</code></pre>
<pre><code>## RandomForestClassifier(bootstrap=True, class_weight=None, criterion=&#39;gini&#39;,
##                        max_depth=None, max_features=&#39;auto&#39;, max_leaf_nodes=None,
##                        min_impurity_decrease=0.0, min_impurity_split=None,
##                        min_samples_leaf=1, min_samples_split=2,
##                        min_weight_fraction_leaf=0.0, n_estimators=100,
##                        n_jobs=None, oob_score=False, random_state=None,
##                        verbose=0, warm_start=False)</code></pre>
<pre class="python"><code>rf.score(test,labels_test)</code></pre>
<pre><code>## 0.7832167832167832</code></pre>
<pre class="python"><code>prd_ds = test.copy()
prd_ds[&#39;actual&#39;]  = labels_test
prd_ds[&#39;prds&#39;] = rf.predict(test)

prd_ds[&#39;wrong&#39;]  =  prd_ds[&#39;prds&#39;] == prd_ds[&#39;actual&#39;]</code></pre>
<pre class="r"><code>py$prd_ds %&gt;% head()</code></pre>
<pre><code>##     PassengerId Pclass Age SibSp Parch     Fare Embarked_C Embarked_Q
## 505         506      1  18     1     0 108.9000          1          0
## 262         263      1  52     1     1  79.6500          0          0
## 703         704      3  25     0     0   7.7417          0          1
## 407         408      2   3     1     1  18.7500          0          0
## 794         795      3  25     0     0   7.8958          0          0
## 489         490      3   9     1     1  15.9000          0          0
##     Embarked_S Sex_binary actual prds wrong
## 505          0          0      0    1 FALSE
## 262          1          0      0    0  TRUE
## 703          0          0      0    0  TRUE
## 407          1          0      1    1  TRUE
## 794          1          0      0    0  TRUE
## 489          1          0      1    0 FALSE</code></pre>
<pre class="python"><code>import lime
import lime.lime_tabular
import dtreeviz
import shap</code></pre>
<pre class="python"><code>explainer = lime.lime_tabular.LimeTabularExplainer(
train.to_numpy(),
feature_names = list(train.columns),
class_names = [0,1],
discretize_continuous = True
)</code></pre>
<pre class="python"><code>instance = test.iloc[1,:]
exp = explainer.explain_instance(instance,
rf.predict_proba,
num_features = 5,
top_labels = 1
)</code></pre>
<pre class="python"><code>
from IPython.display import display, HTML
exp.show_in_notebook(show_table = True,show_all = True)
</code></pre>
<pre><code>## &lt;IPython.core.display.HTML object&gt;</code></pre>
<pre class="python"><code>s = exp.as_html()</code></pre>
<pre class="r"><code>library(rvest)</code></pre>
<pre><code>## Loading required package: xml2</code></pre>
<pre><code>## 
## Attaching package: &#39;rvest&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:purrr&#39;:
## 
##     pluck</code></pre>
<pre><code>## The following object is masked from &#39;package:readr&#39;:
## 
##     guess_encoding</code></pre>
<pre class="r"><code>#htmltools::</code></pre>
<pre class="r"><code>library(lime)</code></pre>
<pre><code>## 
## Attaching package: &#39;lime&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     explain</code></pre>
<pre class="r"><code>library(tidymodels)</code></pre>
<pre><code>## -- Attaching packages -------------------------------------------------------------------------------- tidymodels 0.1.0 --</code></pre>
<pre><code>## &lt;U+221A&gt; broom     0.5.4     &lt;U+221A&gt; rsample   0.0.5
## &lt;U+221A&gt; dials     0.0.4     &lt;U+221A&gt; tune      0.0.1
## &lt;U+221A&gt; infer     0.5.1     &lt;U+221A&gt; workflows 0.1.0
## &lt;U+221A&gt; parsnip   0.0.5     &lt;U+221A&gt; yardstick 0.0.5
## &lt;U+221A&gt; recipes   0.1.9</code></pre>
<pre><code>## -- Conflicts ----------------------------------------------------------------------------------- tidymodels_conflicts() --
## x scales::discard()   masks purrr::discard()
## x lime::explain()     masks dplyr::explain()
## x dplyr::filter()     masks stats::filter()
## x recipes::fixed()    masks stringr::fixed()
## x dplyr::lag()        masks stats::lag()
## x dials::margin()     masks ggplot2::margin()
## x rvest::pluck()      masks purrr::pluck()
## x yardstick::spec()   masks readr::spec()
## x recipes::step()     masks stats::step()
## x recipes::yj_trans() masks scales::yj_trans()</code></pre>
<pre class="r"><code>library(ranger) </code></pre>
<pre class="r"><code>library(naniar)
#vis_miss(titanic_training)
#complete.cases(titanic_training)</code></pre>
<p>The lime package for R does not aim to be a line-by-line port of its Python counterpart. I</p>
<p><a href="https://uc-r.github.io/lime" class="uri">https://uc-r.github.io/lime</a>
<a href="https://cran.r-project.org/web/packages/lime/vignettes/Understanding_lime.html" class="uri">https://cran.r-project.org/web/packages/lime/vignettes/Understanding_lime.html</a></p>
<pre class="python"><code>import wikipedia
wikipedia.set_lang(&#39;nl&#39;)
wikipedia.summary(&#39;Abel Tasman&#39;)</code></pre>
<pre><code>## &#39;Abel Janszoon Tasman (Lutjegast, 1603 – Batavia, 10 oktober 1659) was een Nederlands ontdekkingsreiziger in dienst van de Vereenigde Oost-Indische Compagnie (VOC). Hij is het bekendst door zijn reizen tussen 1642 en 1644, opgezet door Antonie van Diemen. Tijdens deze reis ontdekte hij Tasmanië, Nieuw-Zeeland en Tongatapu. Alleen op het laatste eiland werd de bemanning vriendelijk onthaald.\nTasman had als opdracht het land te onderzoeken dat toen bekendstond als Nieuw-Holland (het tegenwoordige Australië), waarvan de westkust al door Nederlanders ontdekt was, om vast te stellen of het land deel uitmaakte van het vermeende Terra Australis, een zuidelijk continent, dat zou moeten bestaan om de aarde in evenwicht te houden. De VOC hoopte dat door deze reis dit onbekende continent voor de handel geopend en vervolgens geëxploiteerd zou kunnen worden.&#39;</code></pre>
