---
title: An R Markdown document converted from "test.ipynb"
output: html_document
---

```{python}
import pandas as pd
from sklearn.ensemble import RandomForestClassifier
from sklearn.model_selection import train_test_split
```

```{python}
titanic = pd.read_csv('titanic_train.csv')
titanic.head()
```

```{python}
def sex_binary(x):
  if x == 'male':
    return 0 
  else:
    return 1
titanic_dummified = pd.get_dummies(titanic,columns=['Embarked'])
titanic_dummified['Sex_binary'] = titanic_dummified['Sex'].apply(lambda x:sex_binary(x) )
titanic_dummified.drop(['Cabin','Ticket','Name','Sex'],axis = 1,inplace=True)
titanic_dummified.head()
titanic_dummified.shape
titanic_dummified = titanic_dummified.dropna()
titanic_dummified.isna().sum()
```

```{python}
X = titanic_dummified.drop(['Survived'],axis=1)
y = titanic_dummified['Survived']
train, test, labels_train, labels_test = train_test_split(X, y, train_size=0.80)
```

```{python}
rf = RandomForestClassifier(n_estimators=100)
rf.fit(train,labels_train)
rf.score(test,labels_test)
```

```{python}
prd_ds = test.copy()
prd_ds['actual']  = labels_test
prd_ds['prds'] = rf.predict(test)

prd_ds['wrong']  =  prd_ds['prds'] == prd_ds['actual']
```

```{python}
import lime
import lime.lime_tabular
import dtreeviz
import shap
```

```{python}
explainer = lime.lime_tabular.LimeTabularExplainer(
train.to_numpy(),
feature_names = list(train.columns),
class_names = [0,1],
discretize_continuous = True
)
```

```{python}
instance = test.iloc[1,:]
exp = explainer.explain_instance(instance,
rf.predict_proba,
num_features = 5,
top_labels = 1
)
```

```{python}
exp.show_in_notebook(show_table = True,show_all = True)
```

